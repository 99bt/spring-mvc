package com.yaowang.lansha.service.impl;import java.util.List;import java.util.Map;import javax.annotation.Resource;import com.yaowang.common.dao.PageDto;import com.yaowang.lansha.dao.LanshaAdvertisementDao;import com.yaowang.lansha.entity.LanshaAdvertisement;import com.yaowang.lansha.service.LanshaAdvertisementService;import com.yaowang.util.filesystem.util.FileSystemUtil;import com.yaowang.util.filesystem.util.FileUtil;import com.yaowang.util.filesystem.util.StorePathUtil;import org.apache.commons.lang.StringUtils;import org.springframework.stereotype.Service;/** * 蓝鲨广告  * @author  *  */@Service("lanshaAdvertisementService")public class LanshaAdvertisementServiceImpl implements LanshaAdvertisementService{	@Resource	private LanshaAdvertisementDao lanshaAdvertisementDao;		@Override	public LanshaAdvertisement save(LanshaAdvertisement entity){		return lanshaAdvertisementDao.save(entity);	}		@Override	public Integer delete(String[] ids){		return lanshaAdvertisementDao.delete(ids);	}		@Override	public Integer update(LanshaAdvertisement entity){		return lanshaAdvertisementDao.update(entity);	}		@Override	public LanshaAdvertisement getLanshaAdvertisementById(String id){		return lanshaAdvertisementDao.getLanshaAdvertisementById(id);	}	@Override	public LanshaAdvertisement getLanshaAdvertisementByRate(){		float rate = (float)(Math.random()*10);		return lanshaAdvertisementDao.getLanshaAdvertisementByRate(rate);	}		@Override	public Map<String, LanshaAdvertisement> getLanshaAdvertisementMapByIds(String[] ids){		return lanshaAdvertisementDao.getLanshaAdvertisementMapByIds(ids);	}		@Override	public List<LanshaAdvertisement> getLanshaAdvertisementList(LanshaAdvertisement entity){		return lanshaAdvertisementDao.getLanshaAdvertisementList(entity);	}		@Override	public List<LanshaAdvertisement> getLanshaAdvertisementPage(LanshaAdvertisement entity, PageDto page){		return lanshaAdvertisementDao.getLanshaAdvertisementPage(entity, page);	}	@Override	public void saveImgFile(LanshaAdvertisement entity, String uploadPath)			throws Exception {		if(StringUtils.isNotBlank(entity.getImg())){			//去掉uploadPath			String headpic = entity.getImg();						if(headpic.contains(uploadPath) || headpic.contains(uploadPath.replace("/", "\\"))){				int index = headpic.indexOf(uploadPath);				if(index < 0){					index = headpic.indexOf(uploadPath.replace("/", "\\"));				}				headpic = headpic.substring(index+uploadPath.length());			}						//原图			String ext = FileUtil.getExtensionName(headpic);			String destPath = StorePathUtil.buildPath(entity.getId(), "advertisement", "headpic." + ext).toString();			FileSystemUtil.copyTempFile(headpic, destPath);			//删除原有文件			FileSystemUtil.deleteFile(headpic);			entity.setImg(destPath);		}			}	}